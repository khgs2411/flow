# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Important rules and guidelines
- **This project leverages 'flow framework'**: This project uses the flow framework for project management. Follow flow conventions for tasks, iterations, and brainstorming. ALWAYS try to use the agent skills where possible as a first priority for the best results. Alternatively, suggest using the slash commands to interact with the flow system.


## Repository Overview

Flow is a human-in-loop development methodology framework combining Domain-Driven Design principles with Agile philosophy. It provides AI-driven slash commands and agent skills that guide iterative development where humans make decisions and AI executes within that framework.

**Key Philosophy**: Humans drive architecture and decisions. AI implements within your framework. Context is never lost.

## Architecture

### Three-Part System

1. **`flow.sh` (~437KB)**: Self-contained deployment script with all framework content embedded as heredocs. This is the single distribution file users download. Generated by `build-standalone.sh`.

2. **`framework/` (source files)**: The canonical source content that gets embedded into flow.sh:

   - `DEVELOPMENT_FRAMEWORK.md` (~3,900 lines) - Complete Flow methodology
   - `SLASH_COMMANDS.md` - All command definitions (28 commands)
   - `examples/` - Reference examples (DASHBOARD.md, PLAN.md, task files)
   - `skills/` - Agent skill definitions (6 skills with supporting files)

3. **Build System**:
   - `build-standalone.sh` - Generates flow.sh from framework sources
   - `release.sh` - Automates versioning, changelog, git tagging, GitHub releases
   - `VERSION` file - Single source of truth for version number

### Flow Framework File Structure (What Gets Deployed)

When users run `flow.sh` in their project, it creates:

```
user-project/
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ commands/          # 28 slash commands (AI helpers)
â”‚   â”‚   â”œâ”€â”€ flow-blueprint.md
â”‚   â”‚   â”œâ”€â”€ flow-brainstorm-start.md
â”‚   â”‚   â””â”€â”€ ... (25 more)
â”‚   â””â”€â”€ skills/            # 6 Agent Skills
â”‚       â”œâ”€â”€ flow-navigator/
â”‚       â”œâ”€â”€ flow-planner/
â”‚       â”œâ”€â”€ flow-implementer/
â”‚       â”œâ”€â”€ flow-architect/
â”‚       â”œâ”€â”€ flow-reviewer/
â”‚       â””â”€â”€ flow-documenter/
â””â”€â”€ .flow/
    â”œâ”€â”€ DASHBOARD.md       # User's main workspace (progress tracking)
    â”œâ”€â”€ PLAN.md            # Static context (architecture, scope)
    â”œâ”€â”€ phase-N/task-M.md  # Task files with iterations
    â””â”€â”€ framework/         # AI reference files (read-only)
        â”œâ”€â”€ DEVELOPMENT_FRAMEWORK.md
        â”œâ”€â”€ SLASH_COMMANDS.md
        â”œâ”€â”€ skills/SKILLS_GUIDE.md
        â””â”€â”€ examples/
```

**Important**: `framework/` in the repo contains source files. When deployed to user projects, framework content goes to `.flow/framework/` as reference documentation.

### Multi-File Architecture Pattern

Flow uses a **dashboard-first** navigation model:

- **DASHBOARD.md**: Single source of truth for progress. Shows current work pointer (Phase/Task/Iteration), progress overview with ALL phases/tasks/iterations.
- **PLAN.md**: Static context - purpose, goals, architecture, DO/DON'T guidelines. Rarely changes.
- **phase-N/task-M.md**: Work files containing iterations, brainstorming, and action items. All tasks have iterations (no standalone tasks).

## Development Commands

### Building

```bash
# After editing files in framework/, rebuild the distribution
./build-standalone.sh

# This:
# - Validates commandâ†’framework reference mappings
# - Embeds all framework/* content into flow.sh via heredocs
# - Creates a self-contained ~437KB executable
```

### Testing

```bash
# Test in a clean directory
mkdir -p /tmp/test-flow
cd /tmp/test-flow
~/flow/flow.sh

# Verify deployment:
# - .claude/commands/ has 28 files
# - .claude/skills/ has 6 skill directories
# - .flow/framework/DEVELOPMENT_FRAMEWORK.md exists
# - .flow/framework/examples/ contains reference files

# Test with --force flag (overwrites existing files)
~/flow/flow.sh --force
```

### Releasing

Flow uses semantic versioning: `MAJOR.MINOR.PATCH`

```bash
# Single source of truth: VERSION file
cat VERSION  # e.g., 1.3.4

# Option 1: Automatic version increment
./release.sh --patch   # 1.3.4 â†’ 1.3.5 (bug fixes)
./release.sh --minor   # 1.3.4 â†’ 1.4.0 (new features)
./release.sh --major   # 1.3.4 â†’ 2.0.0 (breaking changes)

# Option 2: Manual version
echo "1.5.0" > VERSION
./release.sh

# release.sh automates:
# 1. Runs build-standalone.sh with VERSION
# 2. Prompts for changelog entry
# 3. Updates CHANGELOG.md
# 4. Creates git commit + tag
# 5. Pushes to GitHub
# 6. Creates GitHub release with flow.sh asset
```

**Version Guidelines**:

- **PATCH** (0.0.X): Bug fixes, doc updates, minor improvements
- **MINOR** (0.X.0): New commands, new features, significant enhancements
- **MAJOR** (X.0.0): Breaking changes to framework structure or command behavior

## Code Structure

### Slash Commands (28 total)

Defined in `framework/SLASH_COMMANDS.md`, extracted by `build-standalone.sh`:

**Plan Initialization (4)**: `flow-blueprint`, `flow-migrate`, `flow-plan-update`, `flow-plan-split`

**Phase Lifecycle (3)**: `flow-phase-add`, `flow-phase-start`, `flow-phase-complete`

**Task Lifecycle (3)**: `flow-task-add`, `flow-task-start`, `flow-task-complete`

**Iteration Lifecycle (7)**: `flow-iteration-add`, `flow-brainstorm-start`, `flow-brainstorm-subject`, `flow-brainstorm-review`, `flow-brainstorm-complete`, `flow-implement-start`, `flow-implement-complete`

**Navigation (3)**: `flow-next`, `flow-next-subject`, `flow-next-iteration`

**Status & Validation (5)**: `flow-status`, `flow-summarize`, `flow-verify-plan`, `flow-compact`, `flow-rollback`

**Backlog Management (3)**: `flow-backlog-add`, `flow-backlog-view`, `flow-backlog-pull`

### Agent Skills (6 total)

Defined in `framework/skills/`, each with SKILL.md and supporting files:

1. **flow-navigator**: Dashboard-first navigation guidance with status awareness
2. **flow-planner**: Planning new features, tasks, and iterations
3. **flow-implementer**: Implementation workflow with pre-implementation gates
4. **flow-architect**: Architecture decisions and PLAN.md updates
5. **flow-reviewer**: Read-only verification of plan consistency
6. **flow-documenter**: Task notes and findings documentation

Each skill can have multiple supporting files (e.g., TEMPLATES.md, PATTERNS.md, VERIFICATION.md).

### Build Script Logic

`build-standalone.sh` performs:

1. **Validation**: Ensures all commands in SLASH_COMMANDS.md have proper framework reference markers (ðŸ”´ REQUIRED or ðŸŸ¢ NO FRAMEWORK READING REQUIRED)
2. **Embedding**: Uses heredocs to embed framework content into flow.sh functions
3. **Version Replacement**: Injects VERSION file content into flow.sh header

Key functions generated in flow.sh:

- `extract_command()` - Parses SLASH_COMMANDS.md to extract individual command content
- `get_framework_content()` - Returns embedded DEVELOPMENT_FRAMEWORK.md
- `get_example_*()` - Returns example files (DASHBOARD, PLAN, tasks)
- `get_skill_*()` - Returns skill definitions and supporting files
- `deploy_commands()` - Writes .claude/commands/\*.md files
- `deploy_framework()` - Writes .flow/framework/ files
- `deploy_skills()` - Writes .claude/skills/\* files

## Key Patterns

### Command Definition Format

Each command in `SLASH_COMMANDS.md` follows:

```markdown
## /command-name

**ðŸ”´ REQUIRED: Read Framework Quick Reference First**

- **Read once per session**: .flow/framework/DEVELOPMENT_FRAMEWORK.md lines 1-600

OR

**ðŸŸ¢ NO FRAMEWORK READING REQUIRED**

<!-- COMMAND_START -->

[Command instructions that get extracted to .claude/commands/]

<!-- COMMAND_END -->
```

### Deprecation Handling

Old commands (renamed/removed in v1.0.11+) are tracked in `DEPRECATED_COMMANDS` array in flow.sh and cleaned up during `--force` deployments.

### Framework Reading Strategy

Commands fall into two categories:

- **Category A (ðŸ”´)**: Must read Quick Reference (lines 1-600) once per session
- **Category B (ðŸŸ¢)**: Self-contained, no framework reading needed

This minimizes context usage while ensuring AI has necessary methodology knowledge.

## Important Notes

- **NEVER edit flow.sh directly** - it's generated by build-standalone.sh
- **Always edit source files in framework/** - these are the canonical sources
- All framework content is embedded in flow.sh via heredocs (no external dependencies)
- The build validates command definitions before allowing deployment
- flow.sh is ~437KB and entirely self-contained for easy distribution

## Documentation

- **README.md**: User-facing guide (philosophy, quick start, workflow)
- **CONTRIBUTING.md**: Contributor guide (fork, edit, build, test, release)
- **framework/DEVELOPMENT_FRAMEWORK.md**: Complete Flow methodology (~3,900 lines)
- **framework/SLASH_COMMANDS.md**: All 28 command definitions
- **framework/skills/SKILLS_GUIDE.md**: Agent skills documentation
- **framework/examples/**: Reference examples for AI learning

## Context for AI Instances

When working on this repository:

1. **Framework changes**: Edit `framework/*.md`, then rebuild with `./build-standalone.sh`
2. **Adding commands**: Add to `SLASH_COMMANDS.md` between `<!-- COMMAND_START -->` and `<!-- COMMAND_END -->`, update `COMMANDS` array in build script
3. **Adding skills**: Create in `framework/skills/`, add extraction function to build script
4. **Version changes**: Update `VERSION` file only (single source of truth)
5. **Testing changes**: Always test in clean directory with `./flow.sh --force` after building

The methodology is designed to be framework-agnostic and work with any AI (ChatGPT, Gemini, etc.), but the slash commands + skills integration is optimized for Claude Code.
